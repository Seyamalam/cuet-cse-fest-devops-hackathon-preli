#!/bin/sh

echo "ğŸ” Running pre-push checks..."

# Check Docker files exist
echo "ğŸ“¦ Checking Docker files..."
for file in backend/Dockerfile gateway/Dockerfile docker/compose.development.yaml docker/compose.production.yaml; do
    if [ ! -f "$file" ]; then
        echo "âŒ Missing required file: $file"
        exit 1
    fi
done
echo "âœ… All required Docker files present"

# Lint backend TypeScript
echo "ğŸ“ Type checking backend..."
cd backend
npm run type-check
if [ $? -ne 0 ]; then
    echo "âŒ Backend type check failed!"
    exit 1
fi
cd ..

# Run linting
echo "ğŸ”§ Running linter..."
cd backend
npm run lint 2>/dev/null || true
cd ..

# Verify .env exists
if [ ! -f .env ]; then
    echo "âš ï¸  .env file not found. Using .env.example as reference..."
    if [ ! -f .env.example ]; then
        echo "âŒ No .env.example found!"
        exit 1
    fi
fi

echo "âœ… All pre-push checks passed!"
echo "ğŸ’¡ Tip: Run 'make health' after push to verify deployment"

